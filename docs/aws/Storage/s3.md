# S3

## Overview

* **Amazon S3 (Simple Storage Service)** is an object storage service that offers:

  * Virtually unlimited storage
  * High durability and availability
  * Access over the internet via REST API or SDKs
* It stores **objects** (files) inside **buckets** (containers).

---

## Key Concepts

| Term         | Description                                                                           |
| ------------ | ------------------------------------------------------------------------------------- |
| **Bucket**   | A top-level container for storing objects in S3. Each bucket name is globally unique. |
| **Object**   | The actual data stored in S3 (file + metadata). Each object has a unique key (path).  |
| **Key**      | The full path name of the object within a bucket (e.g. `images/2025/photo.jpg`).      |
| **Region**   | Each bucket is created in a specific AWS region for latency and compliance reasons.   |
| **Metadata** | Additional info about the object (e.g., content type, last modified, custom tags).    |

---

## Durability and Availability

* **Durability:** 99.999999999% (11 nines) — data is replicated across multiple facilities.
* **Availability:** Typically 99.99% depending on the storage class.

---

## Storage Classes

| Storage Class                     | Description                                                | Use Case                         |
| --------------------------------- | ---------------------------------------------------------- | -------------------------------- |
| **S3 Standard**                   | High durability, availability, low latency.                | Frequently accessed data.        |
| **S3 Standard-IA**                | Lower cost, retrieval fee.                                 | Infrequently accessed data.      |
| **S3 One Zone-IA**                | Cheaper, stored in one AZ.                                 | Re-creatable, non-critical data. |
| **S3 Intelligent-Tiering**        | Moves objects between tiers automatically based on access. | Unknown access patterns.         |
| **S3 Glacier Instant Retrieval**  | Millisecond access, low cost.                              | Archival with occasional access. |
| **S3 Glacier Flexible Retrieval** | Minutes to hours retrieval.                                | Archival, long-term backups.     |
| **S3 Glacier Deep Archive**       | 12-hour retrieval time, cheapest.                          | Long-term cold storage.          |

---

## Data Consistency

* **Strong read-after-write** consistency for new objects.
* **Strong consistency** for overwrite and delete operations (as of Dec 2020).

---

## Security and Access Control

1. **IAM Policies** – Control which AWS users or roles can access buckets/objects.
2. **Bucket Policies** – JSON-based rules that apply to all requests to a bucket.
3. **ACLs (Access Control Lists)** – Legacy feature for object-level permissions.
4. **Block Public Access** – Prevents accidental public exposure.
5. **Encryption**:

   * **SSE-S3:** Managed by S3 (AES-256)
   * **SSE-KMS:** Managed by AWS KMS (key management + audit)
   * **SSE-C:** Customer-provided encryption keys
   * **Client-side encryption:** You encrypt before upload.

---

## Versioning

* Keeps multiple versions of an object in the same bucket.
* Prevents accidental deletion or overwriting.
* Works well with **S3 Lifecycle Rules**.

---

## Lifecycle Management

* Automate moving objects between storage classes or deleting them.

  * Example: Move to Glacier after 90 days, delete after 365 days.

---

## Replication

| Type                               | Description                                     |
| ---------------------------------- | ----------------------------------------------- |
| **CRR (Cross-Region Replication)** | Copy objects across regions for DR or latency.  |
| **SRR (Same-Region Replication)**  | Copy objects within same region for compliance. |

> Requires **versioning** to be enabled on both source and destination.

---

## Static Website Hosting

* S3 can host static sites (HTML, CSS, JS).
* Example: `http://<bucket-name>.s3-website-<region>.amazonaws.com`
* Can integrate with **CloudFront** for CDN distribution.

---

## Performance Optimization

* **Multipart Upload:** For large files (>100MB).
* **Transfer Acceleration:** Uses Amazon CloudFront’s edge locations to speed up uploads.
* **Prefix-based parallelism:** Avoid performance bottlenecks by using multiple key prefixes (e.g. `img1/`, `img2/`).

---

## Logging and Monitoring

* **S3 Access Logs:** Track requests to your bucket.
* **CloudTrail:** Logs API calls for auditing.
* **CloudWatch Metrics:** Monitor bucket-level activity.

---

## Event Notifications

* Trigger actions on object events (e.g. upload, delete).
* Integrate with:

  * **AWS Lambda** (e.g. process images)
  * **SNS** (send notifications)
  * **SQS** (queue processing)

---

## Common Use Cases

* Backup and restore
* Static website hosting
* Data lake for analytics
* Media storage and delivery
* Log archiving

---

## Pricing Components

1. **Storage used (per GB/month)**
2. **Requests (PUT, GET, DELETE, etc.)**
3. **Data transfer out** to the internet or other regions
4. **Retrieval fees** for infrequent and archival classes

---

## CLI & SDK Examples

**Upload a file:**

```bash
aws s3 cp photo.jpg s3://my-bucket/photos/
```

**Sync a directory:**

```bash
aws s3 sync ./local-folder s3://my-bucket/
```

**List objects:**

```bash
aws s3 ls s3://my-bucket/
```

**Delete an object:**

```bash
aws s3 rm s3://my-bucket/photos/photo.jpg
```
